<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hello Messenger</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* âœ¨ Custom Styles for a Modern Look */
  body {
    font-family: 'Inter', sans-serif;
  }
  
  /* Custom scrollbar for a cleaner look */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #f1f5f9; }
  ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
  ::-webkit-scrollbar-thumb:hover { background: #64748b; }
  
  /* Animation for modal pop-up */
  @keyframes modalPop {
  0% { opacity: 0; transform: translateY(-20px) scale(0.95) rotateX(10deg); }
  100% { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }
}
.animate-fadeIn {
  animation: modalPop 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalPop {
  0% { opacity: 0; transform: translateY(-20px) scale(0.95) rotateX(10deg); }
  100% { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }
}
.animate-fadeIn {
  animation: modalPop 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

  /* Custom styling for chat bubbles */
  #messagesBox .text-right > span { border-radius: 1.25rem 1.25rem 0.25rem 1.25rem; }
  #messagesBox .text-left > span { border-radius: 1.25rem 1.25rem 1.25rem 0.25rem; }

  /* Universal transition for smoother interactions */
  * {
    transition: color, background-color, border-color, transform, box-shadow 0.2s ease-in-out;
  }

  /* âœ… CHANGE 4: Chat area background color change */
  #messenger main {
    background-color: #f1f5f9; /* slate-100 */
    background-image: radial-gradient(#cbd5e1 0.75px, transparent 0.75px);
    background-size: 15px 15px;
  }
</style>
</head>

<body class="antialiased bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">

<nav class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center py-3">
      <h1 class="text-xl font-extrabold text-slate-800 flex items-center gap-2">
        <span class="text-2xl">ğŸ’¬</span>
        <span>Hello<span class="text-cyan-500">Messenger</span></span>
      </h1>
      <button id="menuToggle" class="md:hidden bg-slate-100 text-slate-600 px-2 py-1 rounded-md hover:bg-slate-200">â˜°</button>

      <div class="hidden md:flex space-x-2 items-center">
        <button onclick="showPage('home')" class="px-4 py-2 rounded-lg text-slate-600 font-medium hover:bg-cyan-50 hover:text-cyan-600 hover:-translate-y-0.5 hover:shadow-md">Home</button>
        <button onclick="showPage('about')" class="px-4 py-2 rounded-lg text-slate-600 font-medium hover:bg-cyan-50 hover:text-cyan-600 hover:-translate-y-0.5 hover:shadow-md">About</button>
        <button onclick="showPage('contact')" class="px-4 py-2 rounded-lg text-slate-600 font-medium hover:bg-cyan-50 hover:text-cyan-600 hover:-translate-y-0.5 hover:shadow-md">Contact</button>
        <button onclick="openProfileModal()" class="px-4 py-2 rounded-lg bg-teal-500 hover:bg-teal-600 text-white font-semibold shadow-sm hover:-translate-y-0.5 hover:shadow-lg">Create</button>

        <div class="relative inline-block text-left">
          <button id="loginDropdownBtn" class="px-4 py-2 bg-slate-800 text-white rounded-lg flex items-center font-semibold hover:bg-slate-900 shadow-sm hover:-translate-y-0.5 hover:shadow-lg">
            <span>Login</span>
            <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
          </button>
          <div id="loginDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white border border-slate-200 rounded-xl shadow-lg z-50 overflow-hidden">
            <button onclick="openLoginModal()" class="block w-full text-left px-4 py-2.5 hover:bg-slate-50 text-slate-700 font-medium">ğŸ‘¤ User Login</button>
            <button onclick="window.location.href='admin.html'" class="block w-full text-left px-4 py-2.5 hover:bg-slate-50 text-slate-700 font-medium border-t border-slate-100">ğŸ› ï¸ Admin Login</button>
          </div>
        </div>

        <button onclick="logout()" id="logoutBtn" class="hidden px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold shadow-sm hover:-translate-y-0.5 hover:shadow-lg">Logout</button>
      </div>
    </div>
  </div>
</nav>

<div id="mobileMenu" class="hidden flex flex-col bg-white p-4 space-y-2 md:hidden border-b border-slate-200">
  <button onclick="showPage('home')" class="text-left px-3 py-2 rounded-lg text-slate-700 hover:bg-cyan-50 font-medium">Home</button>
  <button onclick="showPage('about')" class="text-left px-3 py-2 rounded-lg text-slate-700 hover:bg-cyan-50 font-medium">About</button>
  <button onclick="showPage('contact')" class="text-left px-3 py-2 rounded-lg text-slate-700 hover:bg-cyan-50 font-medium">Contact</button>
  <button onclick="openProfileModal()" class="text-left px-3 py-2 rounded-lg text-slate-700 hover:bg-cyan-50 font-medium">Create</button>
  <div class="relative">
    <button id="mobileLoginDropdownBtn" class="w-full text-left px-3 py-2 rounded-lg text-slate-700 hover:bg-cyan-50 font-medium flex items-center justify-between">
      Login
      <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
    </button>
    <div id="mobileLoginDropdown" class="hidden bg-white border rounded-xl shadow-lg mt-1">
      <button onclick="openLoginModal()" class="block w-full text-left px-4 py-2 hover:bg-slate-50">ğŸ‘¤ User Login</button>
      <button onclick="window.location.href='admin.html'" class="block w-full text-left px-4 py-2 hover:bg-slate-50">ğŸ› ï¸ Admin Login</button>
    </div>
  </div>
  <button onclick="logout()" id="mobileLogoutBtn" class="hidden mt-2 w-full px-3 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 font-semibold">Logout</button>
</div>

<div id="home" class="p-6 md:p-10 text-center space-y-12">
  <div class="space-y-4 max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-6xl font-extrabold text-slate-800 tracking-tight">Welcome to <span class="bg-gradient-to-r from-cyan-500 to-teal-400 text-transparent bg-clip-text">Hello Messenger</span></h2>
    <p class="text-lg text-slate-600">Connect safely with verified users â€” a modern way to communicate and bond securely.</p>
  </div>
  <img src="https://cdn-icons-png.flaticon.com/512/4712/4712103.png" alt="Chat Illustration" class="mx-auto w-48 drop-shadow-lg">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
    <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1">
      <div class="bg-teal-100 text-teal-600 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4"><img src="https://cdn-icons-png.flaticon.com/512/942/942748.png" class="w-8 h-8"></div>
      <h3 class="font-bold text-lg text-slate-800">ğŸ”’ Secure Chat</h3><p class="text-slate-600 text-sm mt-1">Private and encrypted conversations for your peace of mind.</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1">
      <div class="bg-cyan-100 text-cyan-600 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828469.png" class="w-8 h-8"></div>
      <h3 class="font-bold text-lg text-slate-800">ğŸ“ Easy Registration</h3><p class="text-slate-600 text-sm mt-1">Quick signup process and instant admin approval.</p>
    </div>
    <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl hover:-translate-y-1">
      <div class="bg-sky-100 text-sky-600 w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-4"><img src="https://cdn-icons-png.flaticon.com/512/1946/1946540.png" class="w-8 h-8"></div>
      <h3 class="font-bold text-lg text-slate-800">ğŸ¤ Safe Connection</h3><p class="text-slate-600 text-sm mt-1">Chat and bond with verified members only.</p>
    </div>
  </div>
  <button onclick="openProfileModal()" class="mt-8 bg-gradient-to-r from-cyan-500 to-teal-500 text-white px-10 py-4 rounded-full shadow-lg hover:shadow-xl hover:scale-105 font-bold text-lg">ğŸš€ Create Your Profile</button>
</div>

<div id="messenger" class="hidden h-[calc(100vh-69px)] flex flex-col">
  <button id="mobileUserToggle" class="p-3 bg-slate-800 text-white font-bold sm:hidden">Show Users</button>
  <div id="mobileUserList" class="hidden bg-white shadow-md max-h-64 overflow-y-auto sm:hidden">
    <div class="p-2 border-b border-slate-200">
        <div class="relative">
            <input id="mobileSearch" type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-400">
            <svg class="w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
    </div>
    <div id="chatUserListMobile" class="space-y-1 p-2"></div>
  </div>

  <div class="flex flex-col sm:flex-row h-full overflow-hidden">
    <aside class="hidden sm:block sm:w-1/3 lg:w-1/4 bg-white border-r border-slate-200 overflow-y-auto">
      <div class="p-4 border-b border-slate-200 sticky top-0 bg-white/80 backdrop-blur-sm">
        <h2 class="font-bold text-xl text-slate-800 mb-3">Users</h2>
        <div class="relative">
            <input id="desktopSearch" type="text" placeholder="Search users..." class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-cyan-400">
            <svg class="w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
      </div>
      <div id="chatUserList" class="p-2 space-y-1"></div>
    </aside>

    <main class="flex-1 flex flex-col">
      <div id="chatHeader" class="bg-white p-4 flex justify-between items-center border-b border-slate-200">
        <span id="chatWith" class="font-bold text-slate-700">Chat with: <span id="chatUserName" class="text-cyan-600">Select User</span></span>
        <span id="currentUserName" class="text-sm text-slate-500">You: -</span>
      </div>
      <div id="messagesBox" class="flex-1 p-4 md:p-6 overflow-y-auto space-y-4"></div>
      <div class="p-4 bg-white/80 backdrop-blur-sm border-t border-slate-200">
        <div class="flex items-center space-x-3">
            <input id="chatInput" type="text" placeholder="Type message..." class="flex-1 p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none">
            <button onclick="sendMessage()" class="bg-gradient-to-r from-cyan-500 to-teal-500 text-white px-6 py-3 rounded-xl hover:opacity-90 shadow-sm font-semibold">Send</button>
        </div>
      </div>
    </main>
  </div>
</div>

<div id="about" class="hidden p-6 max-w-3xl mx-auto text-slate-700"><h2 class="text-3xl font-bold text-slate-800 mb-4 text-center">About</h2><p class="text-lg text-center">Hello Messenger is designed to connect verified users safely and securely.</p></div>
<div id="contact" class="hidden p-6 max-w-3xl mx-auto text-slate-700"><h2 class="text-3xl font-bold text-slate-800 mb-4 text-center">Contact Us</h2><p class="text-lg text-center">Email: <a href="mailto:support@hellomessenger.com" class="text-cyan-600 hover:underline">support@hellomessenger.com</a></p></div>

<!-- ğŸŒˆ Modern 3D Animated Profile Creation Modal -->
<div id="profileModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 backdrop-blur-sm z-50 p-4">
  <div class="relative bg-white/10 backdrop-blur-2xl border border-white/30 rounded-3xl shadow-[0_0_30px_rgba(99,102,241,0.4)] p-8 w-full max-w-md space-y-4 transform transition-all duration-300 hover:scale-[1.02] animate-fadeIn">

    <!-- Glowing gradient aura -->
    <div class="absolute inset-0 rounded-3xl bg-gradient-to-br from-indigo-500/30 via-purple-500/30 to-cyan-400/30 blur-2xl -z-10"></div>

    <h2 class="text-3xl font-extrabold text-center text-white drop-shadow-lg mb-4">ğŸ“ Create Profile</h2>

    <input id="username" placeholder="ğŸ‘¤ Full Name" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none transition-all duration-200" />

    <select id="gender" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none transition-all duration-200">
      <option value="" disabled selected>âš§ï¸ Select Gender</option>
      <option value="Male" class="text-black">Male</option>
      <option value="Female" class="text-black">Female</option>
      <option value="Other" class="text-black">Other</option>
    </select>

    <input id="age" type="number" placeholder="ğŸ‚ Age" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none transition-all duration-200" />

    <input id="mobile" type="text" placeholder="ğŸ“± Mobile Number" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none transition-all duration-200" />

    <input id="password" type="password" placeholder="ğŸ”‘ Password" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-indigo-400 focus:outline-none transition-all duration-200" />

    <div class="flex gap-3 pt-2">
      <button onclick="closeProfileModal()" 
        class="w-1/2 bg-white/10 border border-white/30 text-white py-3 rounded-xl font-semibold hover:bg-white/20 transition duration-200">
        âŒ Cancel
      </button>

      <button onclick="saveProfile()" 
        class="w-1/2 bg-gradient-to-r from-indigo-500 via-purple-500 to-cyan-400 text-white py-3 rounded-xl font-semibold text-lg shadow-lg hover:shadow-[0_0_20px_rgba(129,140,248,0.5)] hover:scale-105 transition-transform duration-300">
        ğŸ’¾ Save
      </button>
    </div>

    <p id="profileMsg" class="text-sm text-center pt-2 text-white/90 h-5"></p>
  </div>
</div>

<!-- âœ¨ Modern 3D Animated Login Modal -->
<div id="loginModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
  <div class="relative bg-white/10 backdrop-blur-xl w-full max-w-xs p-8 rounded-3xl border border-white/30 shadow-[0_0_30px_rgba(6,182,212,0.3)] animate-fadeIn space-y-5 transform transition-all duration-300 hover:scale-[1.02]">
    
    <!-- Floating Glow Ring -->
    <div class="absolute inset-0 rounded-3xl bg-gradient-to-br from-cyan-400/40 to-teal-400/40 blur-3xl -z-10"></div>

    <!-- Title -->
    <h2 class="text-3xl font-extrabold text-center text-white drop-shadow-lg">ğŸ” User Login</h2>
    
    <!-- Inputs -->
    <input id="loginMobile" placeholder="ğŸ“± Mobile No" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all duration-200" />
    
    <input id="loginPass" type="password" placeholder="ğŸ”‘ Password" 
      class="w-full p-3 bg-white/20 border border-white/30 text-white placeholder-white/70 rounded-xl focus:ring-2 focus:ring-cyan-400 focus:outline-none transition-all duration-200" />

    <!-- Buttons -->
    <button onclick="loginUser()" 
      class="w-full bg-gradient-to-r from-cyan-500 to-teal-400 text-white py-3 rounded-xl font-semibold text-lg shadow-lg hover:shadow-[0_0_20px_rgba(6,182,212,0.4)] hover:scale-105 transition-transform duration-300">
      ğŸš€ Login
    </button>
    
    <button onclick="closeLoginModal()" 
      class="w-full bg-white/10 border border-white/30 text-white py-3 rounded-xl font-semibold hover:bg-white/20 transition duration-200">
      âŒ Close
    </button>

    <p id="loginMsg" class="text-sm text-center pt-2 text-white/90 h-5"></p>
  </div>
</div>


<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBjyTMgP5mNf3ZMI-ZXKnzu0MP1Uz9omec",
  authDomain: "bandhan-chat.firebaseapp.com",
  projectId: "bandhan-chat",
  storageBucket: "bandhan-chat.firebasestorage.app",
  messagingSenderId: "852469205550",
  appId: "1:852469205550:web:a7e1c1723477c93169adbf",
  measurementId: "G-QLEYD6WGPY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let currentUser = null;
let activeChat = null;
function showPage(id){
  ["home","about","contact","messenger"].forEach(p=>document.getElementById(p).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.getElementById("mobileMenu").classList.add("hidden");
  if(id==="messenger") loadChatUsers();
}
document.getElementById("menuToggle").addEventListener("click", ()=> {
  document.getElementById("mobileMenu").classList.toggle("hidden");
});
document.addEventListener("click", (e) => {
  const btn = document.getElementById("loginDropdownBtn");
  const menu = document.getElementById("loginDropdown");
  if (btn.contains(e.target)) menu.classList.toggle("hidden");
  else if (!menu.contains(e.target)) menu.classList.add("hidden");
  const mbtn = document.getElementById("mobileLoginDropdownBtn");
  const mmenu = document.getElementById("mobileLoginDropdown");
  if (mbtn && mbtn.contains(e.target)) mmenu.classList.toggle("hidden");
  else if (mmenu && !mmenu.contains(e.target)) mmenu.classList.add("hidden");
});
document.getElementById("mobileUserToggle").addEventListener("click", () => {
  if (!currentUser) {
    alert("âŒ Please login first!");
    return;
  }
  const mobileList = document.getElementById("mobileUserList");
  const mobileToggleBtn = document.getElementById("mobileUserToggle");
  mobileList.classList.toggle("hidden");
  mobileToggleBtn.innerText = mobileList.classList.contains("hidden") ? "Show Users" : "Hide Users";
});
function openProfileModal(){ document.getElementById("profileModal").classList.remove("hidden"); document.getElementById("profileModal").classList.add("flex"); }
function closeProfileModal(){ document.getElementById("profileModal").classList.add("hidden"); document.getElementById("profileModal").classList.remove("flex"); }
function openLoginModal(){ document.getElementById("loginModal").classList.remove("hidden"); document.getElementById("loginModal").classList.add("flex"); }
function closeLoginModal(){ document.getElementById("loginModal").classList.add("hidden"); document.getElementById("loginModal").classList.remove("flex"); }
async function registerUser(){
  const name = document.getElementById("regName").value.trim();
  const gender = document.getElementById("regGender").value;
  const age = document.getElementById("regAge").value;
  const mobile = document.getElementById("regMobile").value.trim();
  const pass = document.getElementById("regPass").value;
  if(!name || !gender || !age || !mobile || !pass){
    document.getElementById("regMsg").innerText = "Fill all fields!";
    return;
  }
  const userDoc = await db.collection("users").doc(mobile).get();
  if(userDoc.exists){
    document.getElementById("regMsg").innerText = "âŒ User already registered. Please login.";
    return;
  }
  await db.collection("users").doc(mobile).set({
    username: name, gender, age, mobile, password: pass, verified: false
  });
  document.getElementById("regMsg").innerText = "âœ… Profile created (Waiting for approval)";
}
async function loginUser() {
  const mobile = document.getElementById("loginMobile").value.trim();
  const pass = document.getElementById("loginPass").value;
  if (!mobile || !pass) {
    document.getElementById("loginMsg").innerText = "âŒ Please enter mobile and password.";
    return;
  }
  const snap = await db.collection("users").where("mobile", "==", mobile).get();
  if (snap.empty) {
    document.getElementById("loginMsg").innerText = "âŒ User not found";
    return;
  }
  const u = snap.docs[0].data();
  if (u.password !== pass) {
    document.getElementById("loginMsg").innerText = "âŒ Wrong password";
    return;
  }
  if (!u.verified) {
    document.getElementById("loginMsg").innerText = "âŒ Not verified by Admin";
    return;
  }
  currentUser = u;
  document.getElementById("logoutBtn").classList.remove("hidden");
  document.getElementById("mobileLogoutBtn").classList.remove("hidden");
  closeLoginModal();
  showPage("messenger");
}
function logout() {
  currentUser = null;
  document.getElementById("logoutBtn").classList.add("hidden");
  document.getElementById("mobileLogoutBtn").classList.add("hidden");
  document.getElementById("chatUserList").innerHTML = "";
  document.getElementById("messagesBox").innerHTML = "";
  showPage("home");
  alert("âœ… Logged out successfully!");
}
function loadChatUsers() {
  if (!currentUser) return;
  db.collection("users").where("verified", "==", true).get().then(snap => {
    const desktopList = document.getElementById("chatUserList");
    const mobileList = document.getElementById("chatUserListMobile");
    desktopList.innerHTML = "";
    mobileList.innerHTML = "";
    snap.forEach(doc => {
      const u = doc.data();
      if (u.mobile === currentUser.mobile) return;
      const userHTML = `
        <div class="flex items-center p-3 rounded-xl hover:bg-slate-100 cursor-pointer">
          <div class="w-11 h-11 rounded-full bg-gradient-to-r from-cyan-200 to-teal-200 flex items-center justify-center text-teal-700 font-bold mr-3 flex-shrink-0">
            ${u.username.charAt(0).toUpperCase()}
          </div>
          <div class="flex-grow overflow-hidden">
            <span class="font-semibold text-slate-800 truncate block">${u.username}</span>
            <div class="text-sm text-slate-500">${u.online ? "Online" : "Offline"}</div>
          </div>
        </div>`;
      const desktopDiv = document.createElement("div");
      desktopDiv.innerHTML = userHTML;
      desktopDiv.onclick = () => openChat(u.mobile, u.username);
      desktopList.appendChild(desktopDiv);
      const mobileDiv = document.createElement("div");
      mobileDiv.className = "p-2 rounded-lg bg-slate-50 hover:bg-cyan-50 cursor-pointer text-slate-700 font-medium";
      mobileDiv.innerText = u.username;
      mobileDiv.onclick = () => {
        openChat(u.mobile, u.username);
        document.getElementById("mobileUserList").classList.add("hidden");
        document.getElementById("mobileUserToggle").innerText = "Show Users";
      };
      mobileList.appendChild(mobileDiv);
    });
  });
}
function openChat(mobile, name) {
  activeChat = { id: mobile, username: name };
  document.getElementById("chatUserName").innerText = name;
  if (currentUser) {
    document.getElementById("currentUserName").innerText = "You: " + currentUser.username;
  }
  loadMessages();
}
function loadMessages(){
  if(!activeChat||!currentUser) return;
  const chatId=[currentUser.mobile,activeChat.id].sort().join("_");
  db.collection("messages").doc(chatId).collection("msgs").orderBy("time","asc")
  .onSnapshot(snap=>{
    const box=document.getElementById("messagesBox");
    box.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const div=document.createElement("div");
      div.className = d.from === currentUser.mobile ? "text-right" : "text-left";
      div.innerHTML=`<span class="inline-block px-4 py-2.5 rounded-2xl max-w-md ${d.from===currentUser.mobile?'bg-gradient-to-r from-cyan-500 to-teal-500 text-white shadow':'bg-white text-slate-700 shadow-sm'}">${d.text}</span>`;
      box.appendChild(div);
    });
    box.scrollTop=box.scrollHeight;
  });
}
async function sendMessage(){
  const msg=document.getElementById("chatInput").value.trim();
  if(!msg||!activeChat||!currentUser) return;
  const chatId=[currentUser.mobile,activeChat.id].sort().join("_");
  await db.collection("messages").doc(chatId).collection("msgs").add({
    text:msg, from:currentUser.mobile, time:firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("chatInput").value="";
}

// âœ… FUNCTION TO FILTER USERS (Existing logic is good)
function filterUsers(searchTerm) {
Â  Â  const term = searchTerm.toLowerCase();

Â  Â  // Filter desktop list
Â  Â  // Target the wrapper div which is the direct child of #chatUserList
Â  Â  const desktopUsers = document.querySelectorAll("#chatUserList > div");
Â  Â  desktopUsers.forEach(user => {
Â  Â  Â  Â  // Find the element containing the username text
Â  Â  Â  Â  const userName = user.querySelector(".font-semibold").innerText.toLowerCase();
Â  Â  Â  Â  if (userName.includes(term)) {
Â  Â  Â  Â  Â  Â  user.style.display = "block";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  user.style.display = "none";
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Filter mobile list
Â  Â  // Target the wrapper div which is the direct child of #chatUserListMobile
Â  Â  const mobileUsers = document.querySelectorAll("#chatUserListMobile > div");
Â  Â  mobileUsers.forEach(user => {
Â  Â  Â  Â  const userName = user.innerText.toLowerCase();
Â  Â  Â  Â  if (userName.includes(term)) {
Â  Â  Â  Â  Â  Â  user.style.display = "block";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  user.style.display = "none";
Â  Â  Â  Â  }
Â  Â  });
}

// âœ… EVENT LISTENERS FOR THE SEARCH BARS (Now using the new IDs)
document.getElementById('desktopSearch').addEventListener('keyup', (e) => {
Â  Â  filterUsers(e.target.value);
});
document.getElementById('mobileSearch').addEventListener('keyup', (e) => {
Â  Â  filterUsers(e.target.value);
});

</script>
</body>
</html>
